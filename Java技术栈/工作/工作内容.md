# 蟹卡

## 商品模块

商品分为三类：商品（正常的商品，发物流给客户）、商品卡劵（绑定商品，实物卡，用户可以兑换）、电子卡劵（绑定商品，用户线上输入卡号卡密激活使用）

### 商品属性
商品属性是商品针对规格可选的，例如这里示例的公母属性，那么商品可选的规格就是公蟹、母蟹、公母蟹
![[IMG-20250624173621504.png]]
商品属性添加，输入自定义属性的类别、属性可选的规格选项
![[IMG-20250624174157449.png]]

### 商品分类
**商品分类：** 商品有类别，这个分类是管理员后台自定义的类别，不同于商品的上面三大类
1. 商品分类列表页面：分类类型、分类名称、分类图片...
![[IMG-20250624171649470.png]]
2. 添加商品分类：这里选择的分类类型是三类（商品、商品卡劵、电子卡劵），属性类别关联商品属性，关联分类能选的属性规格
![[IMG-20250624171855691.png]]
### 商品信息
商品列表：
![[IMG-20250624175958592.png]]

添加商品：商品类别关联上面商品分类，可选的商品规格都是分类带过来的属性，可以创建多个商品的规格。
![[IMG-20250624181203908.png]]


添加商品卡劵：？
![[IMG-20250624181319499.png]]

添加电子卡劵：？
![[IMG-20250624181416175.png]]

商家评论：查看商品关联的评论信息
![[IMG-20250624181502153.png]]

设置预约：？
![[IMG-20250624181534924.png]]

## 卡劵管理
**卡劵管理模块开发：**
业务梳理：
- 卡劵需要和商品做关联（商品有不同的规格，需要和不同规格商品做关联），添加的话是添加一批卡劵，关于卡劵和商品的数量是否要对的上，尚不清楚（也就是说商品规格的库存是100，那么我创建对应的卡劵数量是101，那么此时不够是不是不允许创建，我这里创建卡劵只是关联，并不会去扣减商品规格的库存，只做了关联！！！）
- 关于提货规格，如果选择的是分两次提或者是"一次全提/分两次提"，那么就需要去填写提货规格，提货规格的意义在于用户第一次提货可以按照卡劵设定的提货规格去选，第二次提货就是根据商品规格的数量自动算出第二次提要提的数量。
- 卡券激活状态分为手动激活和自动激活
自动激活：默认未激活，根据物流状态显示已签收后自动激活；未收货退款还是未激活状态；已收货未使用退款自动变为已失效状态，撤销退款变为原始状态
- 卡劵可以提货的日期？

小程序端我的卡包模块？未实现

卡劵管理首页面：
![[IMG-20250610120133908.png]]
添加/编辑页面：
![[IMG-20250610120159391.png]]
卡劵详情页面：
![[IMG-20250610120215662.png]]

## 订单、退款售后模块
商品种类：商品、商品卡劵（发货需要）、电子卡劵

订单模块（小程序端）：
### 创建订单
创建订单：
- 商品购买，直接购买单个的商品
- 购物车购买，一批商品或者
订单支付：支付创建订单，支付状态为待支付，回调中才修改支付状态为“支付成功”或者“支付失败”
1. 商品订单支付成功：47，下面是参数
```java
{

    "username": "durant",

    "nickname": "张三",

    "appid": "oLwZb7MF6xLcxX6OZTDX0gMMp2uM",

    "productSpecId": 119,

    "buyCount": 2,

    "price": "0.02",

    "description": "备注备注",

    "addressId": 8

}
```
2. 商品卡劵订单支付：支付成功，订单id48
```java
{

    "username": "durant",

    "nickname": "张三",

    "appid": "oLwZb7MF6xLcxX6OZTDX0gMMp2uM",

    "cardId": 79,

    "buyCount": 2,

    "price": "0.02",

    "description": "商品卡劵订单购买测试",

    "addressId": 8

}
```
3. 电子卡劵订单支付：订单id是49
```java
{

    "username": "durant",

    "nickname": "张三",

    "appid": "oLwZb7MF6xLcxX6OZTDX0gMMp2uM",

    "cardId": 78,

    "buyCount": 2,

    "price": "0.02",

    "description": "商品电子卡劵订单购买测试",

    "addressId": 8

}
```

支付回调：
1. 支付成功，设置支付状态为“支付成功”，物流状态为“待发货”，支付时间，事务号（微信订单号）；然后修改库存
```xml
<update id="updateOrderByorderNo">  
    update t_order_manager  
    set        pay_status = 2,        update_time = sysdate(),        pay_time = sysdate(),        express_status = 1,        transaction_id = #{transactionId}    where order_no = #{orderNumber} and pay_status = 1
</update>
```
![[IMG-20250625145233294.png]]
2. 回调失败，直接返回一个回调失败的返回。
![[IMG-20250625145342085.png]]
3. 超时30分钟，修改订单状态为“订单取消”
![[IMG-20250625145519006.png]]

### 订单操作
订单操作：
- 默认展示全部状态的订单(待付款、取消订单、待发货、待收货、待评价、已评价)
- 订单失效情况（超时未支付、用户取消）
```java
取消订单接口：因为创建的订单只是创建一个订单，支付状态为待支付，如果点击取消，那么修改订单状态为“取消订单”，并且设置取消的时间
<update id="updatePayStatusById">  
    update t_order_manager  
    set        pay_status = #{payStatus},        update_time = #{updateTime},        cancel_time = #{cancelTime}    where id = #{id}</update>
```
- 立即付款（针对待支付的订单）
```java
立即付款，针对待支付的订单发起付款就行
```
- 订单详情页面
- 订单评价
```java
针对“支付成功”“待评价”的订单，发起订单评价，评价成功修改订单状态为“支付成功”“已评价”
```
- 订单退款
```java
针对“支付成功”的订单，可发起退款申请，发起修改订单的状态为“退款”“待退款”

商家后台处理退款的订单，同意退款，订单状态是“退款”“退款成功”
商家不同意退款，订单状态是“支付成功”“退款失败”

用户可重新发送退款，重新发送退款继续上面的步骤
```




### 退款
退款：根据订单状态，针对已经付款的订单发起退款请求，但是只是请求，商家还要根据退款请求判断是否要给他退款成功还是退款失败
- 创建退款售后订单
- 撤销售后
- 查询售后订单
- 商家处理（驳回/确认退款）

**业务梳理：**
```java
订单支付状态：1待支付 2支付成功 3订单失效 4退款
退款状态：1：退款中/待退款，2：已退款/退款完成，3：退款取消/退款失败
物流状态：1：待发货，2：待收货，3：已收货待评价 4：已评价
```
- 退款：用户发起退款请求，订单商家处理，商家可打回/通过，商家通过进入退款流程
```
发起退款：支付状态进入4 退款状态进入1 
退款不通过：支付状态进入2  退款状态进入3
退款通过：支付状态4  退款状态进入2
```


商品订单（后台）：
- 查询订单和订单详情接口
![[IMG-20250622222332066.png]]
![[IMG-20250622222347963.png]]
- 关于售后处理的接口
![[IMG-20250622222324490.png]]




## 发票模块

小程序端：开发票
针对订单（现在是针对已经支付成功的订单）开发票
![[IMG-20250622224717335.png]]

后台：开票管理：展示所有已开票、未开票、开票失败的订单
![[IMG-20250622224815240.png]]




## 数据统计分析模块

默认展示所有商城商品总销售额、销售总量、卡券核销总量信息
![[IMG-20250622224907451.png]]












物流：
1. 创建发货单
2. 货品查询
3. 销售单查询
4. 查询物流轨迹信息

开票：
发票红冲？




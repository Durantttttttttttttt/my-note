# æ‰©å±•


# Spelè¡¨è¾¾å¼
SpELï¼ˆSpring Expression Languageï¼‰æ˜¯Springæ¡†æ¶ä¸­ç”¨äºè¡¨è¾¾å¼è¯­è¨€çš„ä¸€ç§æ–¹å¼ã€‚å®ƒç±»ä¼¼äºå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­çš„è¡¨è¾¾å¼è¯­è¨€ï¼Œç”¨äºåœ¨è¿è¡Œæ—¶è®¡ç®—å€¼æˆ–æ‰§è¡Œç‰¹å®šä»»åŠ¡ã€‚

SpELæä¾›äº†ä¸€ç§ç®€å•ä¸”å¼ºå¤§çš„æ–¹å¼æ¥è®¿é—®å’Œæ“ä½œå¯¹è±¡çš„å±æ€§ã€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œä»¥åŠå®ç°è¿ç®—ã€æ¡ä»¶åˆ¤æ–­ç­‰æ“ä½œã€‚å®ƒå¯ä»¥è¢«ç”¨äºXMLå’Œæ³¨è§£é…ç½®ä¸­ï¼Œå¯ä»¥ç”¨äºè®¸å¤šSpringæ¡†æ¶ä¸­çš„ç‰¹æ€§ï¼Œå¦‚ä¾èµ–æ³¨å…¥ã€AOPã€é…ç½®æ–‡ä»¶ç­‰ã€‚

SpELè¡¨è¾¾å¼å¯ä»¥åœ¨å­—ç¬¦ä¸²ä¸­è¿›è¡Œå®šä¹‰ï¼Œä½¿ç”¨ç‰¹æ®Šçš„è¯­æ³•å’Œç¬¦å·æ¥è¡¨ç¤ºç‰¹å®šçš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨${expression}æ¥è¡¨ç¤ºä¸€ä¸ªSpELè¡¨è¾¾å¼ï¼Œå…¶ä¸­expressionæ˜¯å…·ä½“çš„SpELè¯­å¥ã€‚

  


```java
package com.study.spel;

import org.springframework.expression.EvaluationContext;
import org.springframework.expression.ExpressionParser;
import org.springframework.expression.spel.standard.SpelExpressionParser;
import org.springframework.expression.spel.support.SimpleEvaluationContext;
import org.springframework.expression.spel.support.StandardEvaluationContext;

import java.net.Socket;
import java.util.*;

public class Test {
    public static void main(String[] args) throws NoSuchMethodException {
        SpelExpressionParser parser = new SpelExpressionParser();

// evaluates to "Hello World"
        String helloWorld = (String) parser.parseExpression("'Hello World'").getValue();
        System.out.println(helloWorld);

// evaluates to "Tony's Pizza"
        String pizzaParlor = (String) parser.parseExpression("'Tony''s Pizza'").getValue();
        System.out.println(pizzaParlor);
        double avogadrosNumber = (Double) parser.parseExpression("6.0221415E+23").getValue();
        System.out.println(avogadrosNumber);
// evaluates to 2147483647
        int maxValue = (Integer) parser.parseExpression("0x7FFFFFFF").getValue();
        System.out.println(maxValue);
        boolean trueValue = (Boolean) parser.parseExpression("true").getValue();
        System.out.println(trueValue);
        Object nullValue = parser.parseExpression("null").getValue();
        System.out.println(nullValue);

        /*
         *å¯¹è±¡è®¿é—®ï¼Œè¯´æ˜å¯ä»¥æ ¹æ®å±æ€§çš„åç§°ç›´æ¥è®¿é—®åˆ°å¯¹è±¡çš„å±æ€§å€¼ï¼ŒåŒ…æ‹¬å†…éƒ¨çš„å¯¹è±¡å±æ€§ä¹Ÿå¯ä»¥å±‚å±‚è®¿é—®
         */
        Inventor inventor = new Inventor("å¼ ä¸‰", new Date(), "China");
        StandardEvaluationContext zhangsanContext = new StandardEvaluationContext(inventor);
        // evaluates to 1856
        int year = (Integer) parser.parseExpression("birthdate.year + 1900").getValue(zhangsanContext);
        System.out.println("year:" + year);
        PlaceOfBirth placeOfBirth = new PlaceOfBirth("ä¸Šæµ·", "åŒ—äº¬");
        inventor.setPlaceOfBirth(placeOfBirth);
        String city = (String) parser.parseExpression("placeOfBirth.city").getValue(inventor);
        System.out.println("city:"+city);


        /*
        * åˆ—è¡¨
        *
         */
        // å®šä¹‰Parserï¼Œå¯ä»¥å®šä¹‰å…¨å±€çš„parser
        parser = new SpelExpressionParser();

        EvaluationContext context = SimpleEvaluationContext.forReadOnlyDataBinding().build();

        List<Inventor> inventorList = new ArrayList<>();
        inventorList.add(new Inventor("æå››", "China"));
        inventorList.add(new Inventor("å¼ ä¸‰", "China"));
        inventorList.add(new Inventor("ç‹äº”", "China"));
        Society society = new Society();
        society.setMembers(inventorList);

// å–å‡ºsocietyå¯¹è±¡çš„membersæ•°ç»„/é‡Œåˆ—è¡¨çš„ç¬¬äºŒä¸ªæ•°æ®
        String invention = parser.parseExpression("members[1].name").getValue(
                context, society, String.class);
        System.out.println(invention);

        /*
         * map
         */

        Society societyContext = new Society();
        societyContext.officers.put("president", new Inventor("å¼ ä¸‰", "ç¾å›½"));
// å–å‡ºsocietyContextçš„Officersä¸­çš„keyä¸ºpresidentçš„å€¼
        Inventor pupin = parser.parseExpression("Officers['president']").getValue(
                societyContext, Inventor.class);
        System.out.println("é›†åˆï¼š" + pupin);

        String name = parser.parseExpression("Officers['president'].name").getValue(
                societyContext, String.class);
        System.out.println("é›†åˆï¼š" + name);

        /*
         * å†…åµŒlist
         */
        // å®šä¹‰Parserï¼Œå¯ä»¥å®šä¹‰å…¨å±€çš„parser
        parser = new SpelExpressionParser();

        context = SimpleEvaluationContext.forReadOnlyDataBinding().build();

        // [1, 2, 3, 4]
        List numbers = (List) parser.parseExpression("{1,2,3,4}").getValue(context);
        System.out.println("å†…åµŒlistï¼š" + numbers);

        // åµŒå¥—ï¼š [[a, b], [x, y]]
        List listOfLists = (List) parser.parseExpression("{{'a','b'},{'x','y'}}").getValue(context);
        System.out.println("å†…åµŒlistï¼š" + listOfLists);

        /*
         * å†…åµŒmapï¼Œç›´æ¥ç”¨å­—ç¬¦ä¸²è¡¨ç¤ºmapé›†åˆ
         */
        // {name=Nikola, dob=10-July-1856}
        Map inventorInfo = (Map) parser.parseExpression("{name:'Nikola',dob:'10-July-1856'}").getValue(context);
        System.out.println("å†…åµŒmapï¼š" + inventorInfo);

        /*
        æ•°ç»„åˆå§‹åŒ–
         */
//        int[] numbers1 = (int[]) parser.parseExpression("new int[]{1,2,3}").getValue(context);
//        System.out.println(numbers1);

        /*
        è°ƒç”¨ç±»çš„æ–¹æ³•
         */
        parser = new SpelExpressionParser();

// è°ƒç”¨substringæ–¹æ³•
        String bc = parser.parseExpression("'abc'.substring(1, 3)").getValue(String.class);
        System.out.println("è°ƒç”¨ç±»çš„æ–¹æ³•ï¼š" + bc);
// è°ƒç”¨societyContextä¸­å¯¹è±¡çš„isMemberæ–¹æ³•ï¼Œå¹¶ä¼ å€¼ã€‚
        society = new Society();
        List<Inventor> inventors = new ArrayList<>();
        inventors.add(new Inventor("å¼ ä¸‰", "china"));
        inventors.add(new Inventor("æå››", "china"));
        inventors.add(new Inventor("Mihajlo Pupin", "china"));
        society.setMembers(inventors);
        StandardEvaluationContext societyContextNew = new StandardEvaluationContext(society);
        boolean isMember = parser.parseExpression("isMember('Mihajlo Pupin')").getValue(
                societyContextNew, Boolean.class);
        System.out.println("è°ƒç”¨ç±»çš„æ–¹æ³•åˆ¤æ–­ï¼š" + isMember);

        /*
        spelæ“ä½œç¬¦
         */
        parser = new SpelExpressionParser();
// evaluates to true
        System.out.println("spelæ“ä½œç¬¦ï¼š" + parser.parseExpression("2 == 2").getValue(Boolean.class));
// evaluates to false
        System.out.println("spelæ“ä½œç¬¦ï¼š" + parser.parseExpression("2 < -5.0").getValue(Boolean.class));
// evaluates to true
        System.out.println("spelæ“ä½œç¬¦ï¼š" + parser.parseExpression("'black' < 'block'").getValue(Boolean.class));
        /*
        ä½¿ç”¨åŸºæœ¬ç±»å‹æ—¶è¦å°å¿ƒï¼Œå› ä¸ºå®ƒä»¬ä¼šç«‹å³è¢«è£…ç®±ä¸ºåŒ…è£…å™¨ç±»å‹ï¼Œæ‰€ä»¥1 instanceof T(int)ä¼šè®¡ç®—ä¸ºfalseï¼Œè€Œ1 instanceof T(Integer)ä¼šè®¡ç®—ä¸ºtrueã€‚
         */
        Boolean value = parser.parseExpression("1 instanceof T(Integer)").getValue(Boolean.class);
        Boolean value2 = parser.parseExpression("1 instanceof T(int)").getValue(Boolean.class);
        System.out.println("åŸºæœ¬ç±»å‹è½¬æ¢ï¼š" + value);
        System.out.println("åŸºæœ¬ç±»å‹è½¬æ¢ï¼š" + value2);

        /*
        æ“ä½œç¬¦å¯¹åº”çš„æ–‡æœ¬ï¼š
        lt (<)
        gt (>)
        le (<=)
        ge (>=)
        eq (==)
        ne (!=)
        div (/)
        mod (%)
        not (!)
         */

        /*
        é€»è¾‘è¿ç®—ç¬¦andã€orã€not
         */
        // ç»“æœï¼š false
        boolean falseValue = parser.parseExpression("true and false").getValue(Boolean.class);
        System.out.println("é€»è¾‘è¿ç®—ç¬¦ï¼š" + falseValue);
        // è°ƒç”¨æ–¹æ³•å¹¶æ ¹æ®æ–¹æ³•è¿”å›å€¼åˆ¤æ–­
        String expression = "isMember('Nikola Tesla') or isMember('Mihajlo Pupin')";
        trueValue = parser.parseExpression(expression).getValue(societyContextNew, Boolean.class);
        System.out.println("é€»è¾‘è¿ç®—ç¬¦ï¼š" + trueValue);

        /*
        å¯ä»¥å¯¹æ•°å­—å’Œå­—ç¬¦ä¸²ä½¿ç”¨åŠ æ³•è¿ç®—ç¬¦ã€‚
        åªèƒ½å¯¹æ•°å­—ä½¿ç”¨å‡æ³•ã€ä¹˜æ³•å’Œé™¤æ³•è¿ç®—ç¬¦ã€‚
        ä¹Ÿå¯ä»¥ä½¿ç”¨æ¨¡æ•°(%)å’ŒæŒ‡æ•°å¹‚(^)è¿ç®—ç¬¦ã€‚
        å¼ºåˆ¶æ‰§è¡Œæ ‡å‡†è¿ç®—ç¬¦ä¼˜å…ˆçº§ã€‚
         */
        int two = parser.parseExpression("1 + 1").getValue(Integer.class);  // 2

        String testString = parser.parseExpression(
                "'test' + ' ' + 'string'").getValue(String.class);  // 'test string'

        /*
        è‹¥è¦ç»™å¯¹è±¡è®¾ç½®å±æ€§ï¼Œè¯·ä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦(=)ã€‚è¿™é€šå¸¸åœ¨å¯¹setValueçš„è°ƒç”¨ä¸­å®Œæˆï¼Œä½†ä¹Ÿå¯ä»¥åœ¨å¯¹getValueçš„è°ƒç”¨ä¸­å®Œæˆ
         */

        parser = new SpelExpressionParser();
        context = SimpleEvaluationContext.forReadWriteDataBinding().build();
        inventor = new Inventor();

        //inventorå¯¹è±¡çš„nameå±æ€§èµ‹å€¼
        parser.parseExpression("Name").setValue(context, inventor, "Aleksandar Seovic");

        System.out.println("å¯¹è±¡èµ‹å€¼ï¼š" + inventor.getName()); // Aleksandar Seovic

        // æˆ–è€…è¿™æ ·èµ‹å€¼
        String aleks = parser.parseExpression(
                "Name = 'Aleksandar Seovic2'").getValue(context, inventor, String.class);
        System.out.println("å¯¹è±¡èµ‹å€¼" + inventor.getName()); // Aleksandar Seovic2

        /*
        è·å–ç±»çš„ç±»å‹
        å¯ä»¥ä½¿ç”¨ç‰¹æ®Šçš„Tè¿ç®—ç¬¦æ¥æŒ‡å®šjava.lang.Classçš„å®ä¾‹(ç±»å‹)ã€‚é™æ€æ–¹æ³•ä¹Ÿæ˜¯é€šè¿‡ä½¿ç”¨è¿™ä¸ªæ“ä½œç¬¦æ¥è°ƒç”¨çš„ã€‚
        StandardEvaluationContextä½¿ç”¨TypeLocatoræ¥æŸ¥æ‰¾ç±»å‹ï¼ŒStandardTypeLocator(å¯ä»¥æ›¿æ¢)æ˜¯åŸºäºå¯¹java.langåŒ…çš„ç†è§£è€Œæ„å»ºçš„ã€‚æ‰€ä»¥java.langä¸­ç±»å‹çš„T()å¼•ç”¨ä¸éœ€è¦ä½¿ç”¨å…¨é™å®šåï¼Œä½†æ˜¯å…¶ä»–åŒ…ä¸­çš„ç±»ï¼Œå¿…é¡»ä½¿ç”¨å…¨é™å®šåã€‚
         */
        parser = new SpelExpressionParser();

        Class dateClass = parser.parseExpression("T(java.util.Date)").getValue(Class.class);
        System.out.println("è·å–ç±»çš„ç±»å‹ï¼š" + dateClass);
        Class stringClass = parser.parseExpression("T(String)").getValue(Class.class);
        System.out.println("è·å–ç±»çš„ç±»å‹" + stringClass);
        trueValue = parser.parseExpression(
                        "T(java.math.RoundingMode).CEILING < T(java.math.RoundingMode).FLOOR")
                .getValue(Boolean.class);
        System.out.println("è·å–ç±»çš„ç±»å‹" + trueValue);

        /*
        ä½¿ç”¨newè¿ç®—ç¬¦æ„å»ºå¯¹è±¡
         */
        Inventor einstein = parser.parseExpression(
                        "new com.study.spel.Inventor('Albert Einstein', 'German')")
                .getValue(Inventor.class);
        System.out.println("ä½¿ç”¨newæ„å»ºå¯¹è±¡ï¼š" + einstein.getName() + " " + einstein.getNationality());
        society = new Society();
        inventors = new ArrayList<>();
        society.setMembers(inventors);
        societyContextNew = new StandardEvaluationContext(society);
        //åˆ›å»ºä¸€ä¸ªæ–°çš„Inventorï¼Œå¹¶ä¸”æ·»åŠ åˆ°societyä¸­çš„membersçš„listä¸­
        parser.parseExpression(
                "Members.add(new com.study.spel.Inventor('Albert Einstein', 'German'))").getValue(societyContextNew);
        System.out.println(society.toString());

        /*
        ä½¿ç”¨spelè¡¨è¾¾å¼ä¸­çš„è‡ªå®šä¹‰å˜é‡å’Œ#rootå’Œ#this
         */
        parser = new SpelExpressionParser();
        context = SimpleEvaluationContext.forReadWriteDataBinding().build();
        context.setVariable("username", "yangkai");
        Inventor inventor1 = new Inventor("å¼ ä¸‰", "china");
        parser.parseExpression("Name = #username").getValue(context, inventor1);
        System.out.println("ä½¿ç”¨è‡ªå®šä¹‰çš„å˜é‡ï¼š" + inventor1.getName());
        List<Integer> list = new ArrayList<>();
        list.addAll(Arrays.asList(1, 2, 3, 4, 5, 6, 7));
        ExpressionParser parser2 = new SpelExpressionParser();
        EvaluationContext context2 = SimpleEvaluationContext.forReadWriteDataBinding().build();
        context2.setVariable("params", list);
        List<Integer> result = (List<Integer>)parser2.parseExpression("#params.?[#this>4]").getValue(context2);
        System.out.println("ä½¿ç”¨#thisè¡¨ç¤ºå½“å‰è¯„ä¼°å¯¹è±¡ï¼š" + result);

        /*
        è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•
         */
        context2.setVariable("reverseString", Test.class.getDeclaredMethod("reverseString", String.class));
        String result2 = parser2.parseExpression("#reverseString('hello')").getValue(context2, String.class);
        System.out.println("è°ƒç”¨é™æ€æ–¹æ³•ï¼š" + result2);


    }

    public static String reverseString(String input) {
        StringBuilder backwards = new StringBuilder(input.length());
        for (int i = 0; i < input.length(); i++) {
            backwards.append(input.charAt(input.length() - 1 - i));
        }
        return backwards.toString();
    }
}

```










# è™šæ‹Ÿæœº
è™šæ‹Ÿæœºçš„å®‰è£…æ•™ç¨‹ï¼š[https://blog.csdn.net/weixin_61536532/article/details/129778310](https://blog.csdn.net/weixin_61536532/article/details/129778310)

å…³äºä¸‰ç§ç½‘ç»œçš„é€‰æ‹©ï¼š[https://www.cnblogs.com/cnjavahome/p/11266931.html](https://www.cnblogs.com/cnjavahome/p/11266931.html)

å¼€å‘ç«¯å£ï¼š[https://blog.csdn.net/Bzbtyhydcxy/article/details/106043446](https://blog.csdn.net/Bzbtyhydcxy/article/details/106043446)

[è™šæ‹Ÿæœºä»å®‰è£…åˆ°é…ç½®](02-å°šç¡…è°·æŠ€æœ¯ä¹‹æ¨¡æ¿è™šæ‹Ÿæœºç¯å¢ƒå‡†å¤‡.docx)



Springä¸­çš„InitializingBeançš„ä½¿ç”¨è¯¦è§£
InitializingBeanæ˜¯Springæä¾›çš„æ‹“å±•æ€§æ¥å£ï¼ŒInitializingBeanæ¥å£ä¸ºbeanæä¾›äº†å±æ€§åˆå§‹åŒ–åçš„å¤„ç†æ–¹æ³•ï¼Œå®ƒåªæœ‰ä¸€ä¸ªafterPropertiesSetæ–¹æ³•ï¼Œå‡¡æ˜¯ç»§æ‰¿è¯¥æ¥å£çš„ç±»ï¼Œåœ¨beançš„å±æ€§åˆå§‹åŒ–åéƒ½ä¼šæ‰§è¡Œè¯¥æ–¹æ³•ã€‚

1ã€Springä¸ºbeanæä¾›äº†ä¸¤ç§åˆå§‹åŒ–beançš„æ–¹å¼ï¼Œå®ç°InitializingBeanæ¥å£ï¼Œå®ç°afterPropertiesSetæ–¹æ³•ï¼Œæˆ–è€…åœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡init-methodæŒ‡å®šï¼Œä¸¤ç§æ–¹å¼å¯ä»¥åŒæ—¶ä½¿ç”¨ã€‚

2ã€å®ç°InitializingBeanæ¥å£æ˜¯ç›´æ¥è°ƒç”¨afterPropertiesSetæ–¹æ³•ï¼Œæ¯”é€šè¿‡åå°„è°ƒç”¨init-methodæŒ‡å®šçš„æ–¹æ³•æ•ˆç‡è¦é«˜ä¸€ç‚¹ï¼Œä½†æ˜¯init-methodæ–¹å¼æ¶ˆé™¤äº†å¯¹springçš„ä¾èµ–ã€‚

3ã€å¦‚æœè°ƒç”¨afterPropertiesSetæ–¹æ³•æ—¶å‡ºé”™ï¼Œåˆ™ä¸è°ƒç”¨init-methodæŒ‡å®šçš„æ–¹æ³•ã€‚

åŸæ–‡é“¾æ¥ï¼š[https://blog.csdn.net/TreeShu321/article/details/108180366](https://blog.csdn.net/TreeShu321/article/details/108180366)

# Javaä¸­volatileå…³é”®å­—è§£æ
volatileå…³é”®å­—å¯ä»¥ä¿è¯å¯è§æ€§ï¼Œä½†æ˜¯ä¸ä¿è¯åŸå­æ€§ã€‚

## volatileç¦æ­¢æŒ‡ä»¤é‡æ’
åœ¨è®² JMM çš„æ—¶å€™ï¼Œæˆ‘ä»¬æåˆ°äº†æŒ‡ä»¤é‡æ’ï¼Œç›¸ä¿¡å¤§å®¶éƒ½è¿˜æœ‰å°è±¡ï¼Œæˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹é‡æ’åºéœ€è¦éµå®ˆçš„è§„åˆ™ï¼š

+ é‡æ’åºä¸ä¼šå¯¹å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„æ“ä½œè¿›è¡Œé‡æ’åºã€‚æ¯”å¦‚ï¼š`a=1;b=a;` è¿™ä¸ªæŒ‡ä»¤åºåˆ—ï¼Œå› ä¸ºç¬¬äºŒä¸ªæ“ä½œä¾èµ–äºç¬¬ä¸€ä¸ªæ“ä½œï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æ—¶å’Œå¤„ç†å™¨è¿è¡Œæ—¶è¿™ä¸¤ä¸ªæ“ä½œä¸ä¼šè¢«é‡æ’åºã€‚
+ é‡æ’åºæ˜¯ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œä½†æ˜¯ä¸ç®¡æ€ä¹ˆé‡æ’åºï¼Œå•çº¿ç¨‹ä¸‹ç¨‹åºçš„æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜ã€‚æ¯”å¦‚ï¼š`a=1;b=2;c=a+b` è¿™ä¸‰ä¸ªæ“ä½œï¼Œç¬¬ä¸€æ­¥ (a=1) å’Œç¬¬äºŒæ­¥ (b=2) ç”±äºä¸å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå‘ç”Ÿé‡æ’åºï¼Œä½†æ˜¯ c=a+b è¿™ä¸ªæ“ä½œæ˜¯ä¸ä¼šè¢«é‡æ’åºçš„ï¼Œå› ä¸ºéœ€è¦ä¿è¯æœ€ç»ˆçš„ç»“æœä¸€å®šæ˜¯ c=a+b=3ã€‚

ä½¿ç”¨ volatile å…³é”®å­—ä¿®é¥°å…±äº«å˜é‡å¯ä»¥ç¦æ­¢è¿™ç§é‡æ’åºã€‚æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ

å½“æˆ‘ä»¬ä½¿ç”¨ volatile å…³é”®å­—æ¥ä¿®é¥°ä¸€ä¸ªå˜é‡æ—¶ï¼ŒJava å†…å­˜æ¨¡å‹ä¼šæ’å…¥å†…å­˜å±éšœï¼ˆä¸€ä¸ªå¤„ç†å™¨æŒ‡ä»¤ï¼Œå¯ä»¥å¯¹ CPU æˆ–ç¼–è¯‘å™¨é‡æ’åºåšå‡ºçº¦æŸï¼‰æ¥ç¡®ä¿ä»¥ä¸‹ä¸¤ç‚¹ï¼š

+ å†™å±éšœï¼ˆWrite Barrierï¼‰ï¼šå½“ä¸€ä¸ª volatile å˜é‡è¢«å†™å…¥æ—¶ï¼Œå†™å±éšœç¡®ä¿åœ¨è¯¥å±éšœä¹‹å‰çš„æ‰€æœ‰å˜é‡çš„å†™å…¥æ“ä½œéƒ½æäº¤åˆ°ä¸»å†…å­˜ã€‚
+ è¯»å±éšœï¼ˆRead Barrierï¼‰ï¼šå½“è¯»å–ä¸€ä¸ª volatile å˜é‡æ—¶ï¼Œè¯»å±éšœç¡®ä¿åœ¨è¯¥å±éšœä¹‹åçš„æ‰€æœ‰è¯»æ“ä½œéƒ½ä»ä¸»å†…å­˜ä¸­è¯»å–ã€‚

æ¢å¥è¯è¯´ï¼š

+ å½“ç¨‹åºæ‰§è¡Œåˆ° volatile å˜é‡çš„è¯»æ“ä½œæˆ–è€…å†™æ“ä½œæ—¶ï¼Œåœ¨å…¶å‰é¢æ“ä½œçš„æ›´æ”¹è‚¯å®šå·²ç»å…¨éƒ¨è¿›è¡Œï¼Œä¸”ç»“æœå¯¹åé¢çš„æ“ä½œå¯è§ï¼›åœ¨å…¶åé¢çš„æ“ä½œè‚¯å®šè¿˜æ²¡æœ‰è¿›è¡Œï¼›
+ åœ¨è¿›è¡ŒæŒ‡ä»¤ä¼˜åŒ–æ—¶ï¼Œä¸èƒ½å°† volatile å˜é‡çš„è¯­å¥æ”¾åœ¨å…¶åé¢æ‰§è¡Œï¼Œä¹Ÿä¸èƒ½æŠŠ volatile å˜é‡åé¢çš„è¯­å¥æ”¾åˆ°å…¶å‰é¢æ‰§è¡Œã€‚

â€œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰§è¡Œåˆ° volatile å˜é‡æ—¶ï¼Œå…¶å‰é¢çš„æ‰€æœ‰è¯­å¥éƒ½å¿…é¡»æ‰§è¡Œå®Œï¼Œåé¢æ‰€æœ‰å¾—è¯­å¥éƒ½æœªæ‰§è¡Œã€‚ä¸”å‰é¢è¯­å¥çš„ç»“æœå¯¹ volatile å˜é‡åŠå…¶åé¢è¯­å¥å¯è§ã€‚â€æˆ‘ç…äº†äº†ä¸‰å¦¹ä¸€çœ¼ç»§ç»­è¯´ã€‚

çœ‹ä¸€ä¸‹æœªä½¿ç”¨volatileçš„ä»£ç ï¼š

```java
class ReorderExample {
  int a = 0;
  boolean flag = false;
  public void writer() {
      a = 1;                   //1
      flag = true;             //2
  }
  Public void reader() {
      if (flag) {                //3
          int i =  a * a;        //4
          System.out.println(i);
      }
  }
}
```

å› ä¸ºé‡æ’åºå½±å“ï¼Œæ‰€ä»¥æœ€ç»ˆçš„è¾“å‡ºå¯èƒ½æ˜¯ 0ï¼Œå¼•å…¥volatileï¼š

```java
class ReorderExample {
  int a = 0;
  boolean volatile flag = false;
  public void writer() {
      a = 1;                   //1
      flag = true;             //2
  }
  Public void reader() {
      if (flag) {                //3
          int i =  a * a;        //4
          System.out.println(i);
      }
  }
}
```

è¿™æ—¶å€™ï¼Œvolatile ä¼šç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œè¿™ä¸ªè¿‡ç¨‹å»ºç«‹åœ¨ happens before å…³ç³»çš„åŸºç¡€ä¸Šã€‚

1. æ ¹æ®ç¨‹åºæ¬¡åºè§„åˆ™ï¼Œ1 happens before 2; 3 happens before 4ã€‚
2. æ ¹æ® volatile è§„åˆ™ï¼Œ2 happens before 3ã€‚
3. æ ¹æ® happens before çš„ä¼ é€’æ€§è§„åˆ™ï¼Œ1 happens before 4ã€‚

ä¸Šè¿° happens before å…³ç³»çš„å›¾å½¢åŒ–è¡¨ç°å½¢å¼å¦‚ä¸‹ï¼š

![1723184768116-6a279cd3-fa56-4483-8442-c58ec5c4b6e8.jpeg](1723184768116-6a279cd3-fa56-4483-8442-c58ec5c4b6e8-738335.jpeg)

åœ¨ä¸Šå›¾ä¸­ï¼Œæ¯ä¸€ä¸ªç®­å¤´é“¾æ¥çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä»£è¡¨äº†ä¸€ä¸ª happens before å…³ç³»:

+ é»‘è‰²ç®­å¤´è¡¨ç¤ºç¨‹åºé¡ºåºè§„åˆ™ï¼›
+ æ©™è‰²ç®­å¤´è¡¨ç¤º volatile è§„åˆ™ï¼›
+ è“è‰²ç®­å¤´è¡¨ç¤ºç»„åˆè¿™äº›è§„åˆ™åæä¾›çš„ happens before ä¿è¯ã€‚

è¿™é‡Œ A çº¿ç¨‹å†™ä¸€ä¸ª volatile å˜é‡åï¼ŒB çº¿ç¨‹è¯»åŒä¸€ä¸ª volatile å˜é‡ã€‚A çº¿ç¨‹åœ¨å†™ volatile å˜é‡ä¹‹å‰æ‰€æœ‰å¯è§çš„å…±äº«å˜é‡ï¼Œåœ¨ B çº¿ç¨‹è¯»åŒä¸€ä¸ª volatile å˜é‡åï¼Œå°†ç«‹å³å˜å¾—å¯¹ B çº¿ç¨‹å¯è§

## volatileä¸é€‚ç”¨åœºæ™¯
```java
public class volatileTest {
    public volatile int inc = 0;
    public void increase() {
        inc++;
    }
    public static void main(String[] args) {
        final volatileTest test = new volatileTest();
        for(int i=0;i<10;i++){
            new Thread(){
                public void run() {
                    for(int j=0;j<1000;j++)
                        test.increase();
                };
            }.start();
        }
        while(Thread.activeCount()>1)  //ä¿è¯å‰é¢çš„çº¿ç¨‹éƒ½æ‰§è¡Œå®Œ
            Thread.yield();
        System.out.println("inc output:" + test.inc);
    }
}
```

è¾“å‡ºï¼š

```java
inc output:8182
```

å› ä¸ºinc++ä¸æ˜¯ä¸€ä¸ªåŸå­æ€§çš„æ“ä½œï¼Œç”±è¯»å–ã€åŠ ã€èµ‹å€¼3æ­¥ç»„æˆï¼Œæ‰€ä»¥ç»“æœä¸èƒ½ä¼ è¾¾åˆ°10000

è§£å†³æ–¹æ³•ï¼š

1. ä½¿ç”¨Synchronizedå…³é”®å­—å•ç‹¬ç»™inc++åŠ é”ï¼š

```java
 public synchronized void increase() {
    inc++;
}
```

2. é‡‡ç”¨Lockï¼Œé€šè¿‡å¯é‡å…¥é”ReentrantLockå¯¹inc++åŠ é”ã€‚

```java
Lock lock = new ReentrantLock();
public void increase() {
    lock.lock();
    inc++;
    lock.unlock();
}
```

3. é‡‡ç”¨åŸå­ç±»AtomicInteger

```java
public AtomicInteger inc = new AtomicInteger();
public void increase() {
    inc.getAndIncrement();
}
```

## volatileå®ç°å•ä¾‹æ¨¡å¼çš„åŒé‡é”
ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨"åŒé‡æ£€æŸ¥é”å®š"ï¼ˆdouble-checked lockingï¼‰å®ç°çš„å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰çš„ä¾‹å­ã€‚

```java
public class Penguin {
    private static volatile Penguin m_penguin = null;

    // ä¸€ä¸ªæˆå‘˜å˜é‡ money
    private int money = 10000;

    // é¿å…é€šè¿‡ new åˆå§‹åŒ–å¯¹è±¡ï¼Œæ„é€ æ–¹æ³•åº”ä¸º public æˆ– private
    private Penguin() {}

    public void beating() {
        System.out.println("æ‰“è±†è±†" + money);
    }

    public static Penguin getInstance() {
        if (m_penguin == null) {
            synchronized (Penguin.class) {
                if (m_penguin == null) {
                    m_penguin = new Penguin();
                }
            }
        }
        return m_penguin;
    }
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒPenguin ç±»åªèƒ½è¢«å®ä¾‹åŒ–ä¸€æ¬¡ã€‚æ¥çœ‹ä»£ç è§£é‡Šï¼š

+ å£°æ˜äº†ä¸€ä¸ªç±»å‹ä¸º Penguin çš„ volatile å˜é‡ m_penguinï¼Œå®ƒæ˜¯ç±»çš„é™æ€å˜é‡ï¼Œç”¨æ¥å­˜å‚¨ Penguin ç±»çš„å”¯ä¸€å®ä¾‹ã€‚
+ `Penguin()` æ„é€ æ–¹æ³•è¢«å£°æ˜ä¸º privateï¼Œè¿™æ ·å°±é˜»æ­¢äº†å¤–éƒ¨ä»£ç ä½¿ç”¨ new æ¥åˆ›å»º Penguin å®ä¾‹ï¼Œä¿è¯äº†åªèƒ½é€šè¿‡ `getInstance()` æ–¹æ³•è·å–å®ä¾‹ã€‚
+ `getInstance()` æ–¹æ³•æ˜¯è·å– Penguin ç±»å”¯ä¸€å®ä¾‹çš„å…¬å…±é™æ€æ–¹æ³•ã€‚
+ ç¬¬ä¸€æ¬¡ `if (null == m_penguin)` æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨ Penguin å®ä¾‹ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œæ‰è¿›å…¥åŒæ­¥ä»£ç å—ã€‚
+ `synchronized(penguin.class)` å¯¹ç±»çš„ Class å¯¹è±¡åŠ é”ï¼Œç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—ã€‚åœ¨åŒæ­¥ä»£ç å—ä¸­ï¼Œå†æ¬¡æ‰§è¡Œ `if (null == m_penguin)` æ£€æŸ¥å®ä¾‹æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°çš„å®ä¾‹ã€‚è¿™å°±æ˜¯æ‰€è°“çš„â€œåŒé‡æ£€æŸ¥é”å®šâ€ï¼Œä¸€å…±ä¸¤æ¬¡ã€‚
+ æœ€åè¿”å› m_penguinï¼Œä¹Ÿå°±æ˜¯ Penguin çš„å”¯ä¸€å®ä¾‹ã€‚

å…¶ä¸­ï¼Œä½¿ç”¨ volatile å…³é”®å­—æ˜¯ä¸ºäº†é˜²æ­¢ `m_penguin = new Penguin()` è¿™ä¸€æ­¥è¢«æŒ‡ä»¤é‡æ’åºã€‚å› ä¸ºå®é™…ä¸Šï¼Œ`new Penguin()` è¿™ä¸€è¡Œä»£ç åˆ†ä¸ºä¸‰ä¸ªå­æ­¥éª¤ï¼š

+ æ­¥éª¤ 1ï¼šä¸º Penguin å¯¹è±¡åˆ†é…è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œä¼ªä»£ç  `memory = allocate()`ã€‚
+ æ­¥éª¤ 2ï¼šè°ƒç”¨ Penguin çš„æ„é€ æ–¹æ³•ï¼Œåˆå§‹åŒ–å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œä¼ªä»£ç  `ctorInstanc(memory)`ã€‚
+ æ­¥éª¤ 3ï¼šå°†å†…å­˜åœ°å€èµ‹å€¼ç»™ m_penguin å˜é‡ï¼Œä½¿å…¶æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œä¼ªä»£ç  `instance = memory`ã€‚

å¦‚æœä¸ä½¿ç”¨ volatile å…³é”®å­—ï¼ŒJVM å¯èƒ½ä¼šå¯¹è¿™ä¸‰ä¸ªå­æ­¥éª¤è¿›è¡ŒæŒ‡ä»¤é‡æ’ã€‚

+ ä¸º Penguin å¯¹è±¡åˆ†é…å†…å­˜
+ å°†å¯¹è±¡èµ‹å€¼ç»™å¼•ç”¨ m_penguin
+ è°ƒç”¨æ„é€ æ–¹æ³•åˆå§‹åŒ–æˆå‘˜å˜é‡

è¿™ç§é‡æ’åºä¼šå¯¼è‡´ m_penguin å¼•ç”¨åœ¨å¯¹è±¡å®Œå…¨åˆå§‹åŒ–ä¹‹å‰å°±è¢«å…¶ä»–çº¿ç¨‹è®¿é—®åˆ°ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°æ­¥éª¤ 2 å¹¶è®¾ç½®äº† m_penguin çš„å¼•ç”¨ï¼Œä½†å°šæœªå®Œæˆå¯¹è±¡çš„åˆå§‹åŒ–ï¼Œè¿™æ—¶å¦ä¸€ä¸ªçº¿ç¨‹å¯èƒ½ä¼šçœ‹åˆ°ä¸€ä¸ªâ€œåŠåˆå§‹åŒ–â€çš„ Penguin å¯¹è±¡ã€‚

å‡å¦‚æ­¤æ—¶æœ‰ä¸¤ä¸ªçº¿ç¨‹ A å’Œ Bï¼Œè¦æ‰§è¡Œ `getInstance()` æ–¹æ³•ï¼š

```java
public static Penguin getInstance() {
    if (m_penguin == null) {
        synchronized (Penguin.class) {
            if (m_penguin == null) {
                m_penguin = new Penguin();
            }
        }
    }
    return m_penguin;
}
```

+ çº¿ç¨‹ A æ‰§è¡Œåˆ° `if (m_penguin == null)`ï¼Œåˆ¤æ–­ä¸º trueï¼Œè¿›å…¥åŒæ­¥å—ã€‚
+ çº¿ç¨‹ B æ‰§è¡Œåˆ° `if (m_penguin == null)`ï¼Œåˆ¤æ–­ä¸º trueï¼Œè¿›å…¥åŒæ­¥å—ã€‚

å¦‚æœçº¿ç¨‹ A æ‰§è¡Œ `m_penguin = new Penguin()` æ—¶å‘ç”ŸæŒ‡ä»¤é‡æ’åºï¼š

+ çº¿ç¨‹ A åˆ†é…å†…å­˜å¹¶è®¾ç½®å¼•ç”¨ï¼Œä½†å°šæœªè°ƒç”¨æ„é€ æ–¹æ³•å®Œæˆåˆå§‹åŒ–ã€‚
+ çº¿ç¨‹ B æ­¤æ—¶åˆ¤æ–­ `m_penguin != null`ï¼Œç›´æ¥è¿”å›è¿™ä¸ªâ€œåŠåˆå§‹åŒ–â€çš„å¯¹è±¡ã€‚

è¿™æ ·å°±ä¼šå¯¼è‡´çº¿ç¨‹ B æ‹¿åˆ°ä¸€ä¸ªä¸å®Œæ•´çš„ Penguin å¯¹è±¡ï¼Œå¯èƒ½ä¼šå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸æˆ–è€…å…¶ä»–é—®é¢˜ã€‚

äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º m_penguin å˜é‡æ·»åŠ  volatile å…³é”®å­—ï¼Œæ¥ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œç¡®ä¿å¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆåå†å°†å…¶èµ‹å€¼ç»™ m_penguinã€‚

### æ€»ç»“
volatile å¯ä»¥ä¿è¯çº¿ç¨‹å¯è§æ€§ä¸”æä¾›äº†ä¸€å®šçš„æœ‰åºæ€§ï¼Œä½†æ˜¯æ— æ³•ä¿è¯åŸå­æ€§ã€‚åœ¨ JVM åº•å±‚ volatile æ˜¯é‡‡ç”¨â€œå†…å­˜å±éšœâ€æ¥å®ç°çš„ã€‚

è§‚å¯ŸåŠ å…¥ volatile å…³é”®å­—å’Œæ²¡æœ‰åŠ å…¥ volatile å…³é”®å­—æ—¶æ‰€ç”Ÿæˆçš„æ±‡ç¼–ä»£ç å°±èƒ½å‘ç°ï¼ŒåŠ å…¥ volatile å…³é”®å­—æ—¶ï¼Œä¼šå¤šå‡ºä¸€ä¸ª lock å‰ç¼€æŒ‡ä»¤ï¼Œlock å‰ç¼€æŒ‡ä»¤å®é™…ä¸Šç›¸å½“äºä¸€ä¸ªå†…å­˜å±éšœï¼ˆä¹Ÿç§°å†…å­˜æ …æ ï¼‰ï¼Œå†…å­˜å±éšœä¼šæä¾› 3 ä¸ªåŠŸèƒ½ï¼š

+ å®ƒç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ä¸ä¼šæŠŠå…¶åé¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ï¼Œä¹Ÿä¸ä¼šæŠŠå‰é¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœçš„åé¢ï¼›å³åœ¨æ‰§è¡Œåˆ°å†…å­˜å±éšœè¿™å¥æŒ‡ä»¤æ—¶ï¼Œåœ¨å®ƒå‰é¢çš„æ“ä½œå·²ç»å…¨éƒ¨å®Œæˆï¼›
+ å®ƒä¼šå¼ºåˆ¶å°†å¯¹ç¼“å­˜çš„ä¿®æ”¹æ“ä½œç«‹å³å†™å…¥ä¸»å­˜ï¼›
+ å¦‚æœæ˜¯å†™æ“ä½œï¼Œå®ƒä¼šå¯¼è‡´å…¶ä»– CPU ä¸­å¯¹åº”çš„ç¼“å­˜è¡Œæ— æ•ˆã€‚

æœ€åï¼Œæˆ‘ä»¬å­¦ä¹ äº† volatile ä¸é€‚ç”¨çš„åœºæ™¯ï¼Œä»¥åŠè§£å†³çš„æ–¹æ³•ï¼Œå¹¶è§£é‡Šäº†åŒé‡æ£€æŸ¥é”å®šå®ç°çš„å•ä¾‹æ¨¡å¼ä¸ºä½•éœ€è¦ä½¿ç”¨ volatileã€‚







# CDN
CDNå…¨ç¨‹Content Delivery Networkï¼Œä¸­æ–‡ç¿»è¯‘å†…å®¹åˆ†å‘ç½‘ç»œã€‚CDNçš„ä½œç”¨å°±æ˜¯å°†é™æ€èµ„æºåˆ†é…åˆ°å„ä¸ªæœåŠ¡å™¨ä¸Šï¼Œè®¿é—®çš„æ—¶å€™å¯ä»¥å°±è¿‘è®¿é—®ï¼Œé™ä½æœåŠ¡å™¨çš„å‹åŠ›ã€‚

CDNå’Œå…¨ç«™åŠ é€Ÿçš„å¯¹æ¯”ï¼š

![1725240995422-ccdd09b6-a797-4c98-9c8f-6f2f022805b1.png](1725240995422-ccdd09b6-a797-4c98-9c8f-6f2f022805b1-480574.png)

CDNçš„æ­å»ºé€šå¸¸ä¸éœ€è¦è‡ªå·±é…ç½®ï¼Œé€‰æ‹©åˆé€‚çš„äº‘æœåŠ¡å•†æ›´æœ‰æ€§ä»·æ¯”ã€‚

é‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥å°†æœåŠ¡éƒ¨ç½²åœ¨ä¸åŒçš„åœ°æ–¹ï¼Œè€Œæ˜¯å°†é™æ€èµ„æºåˆ†å¸ƒå‘¢ï¼Ÿ

+ æˆæœ¬å¤ªé«˜ï¼Œéœ€è¦éƒ¨ç½²å¤šä»½ç›¸åŒçš„æœåŠ¡
+ é™æ€èµ„æºé€šå¸¸å ç”¨ç©ºé—´å¤§ä¸”ç»å¸¸è¢«è®¿é—®ï¼Œå¦‚æœæ˜¯è¢«ç³»ç»ŸæœåŠ¡å¤„ç†æˆ–è€…ç¼“å­˜å¤„ç†ï¼Œé‚£ä¹ˆå¯¹ç³»ç»Ÿçš„æ¶ˆè€—æ¯”è¾ƒå¤§ã€‚

**CDNçš„å·¥ä½œåŸç†ï¼š**

+ é™æ€èµ„æºæ˜¯å¦‚ä½•è¢«ç¼“å­˜åˆ°CDNèŠ‚ç‚¹ä¸Šï¼Ÿ
+ å¦‚ä½•æ‰¾åˆ°æœ€åˆé€‚çš„CDNèŠ‚ç‚¹ï¼Ÿ
+ å¦‚ä½•é˜²æ­¢èµ„æºè¢«ç›—åˆ·ï¼Ÿ
1. å¯ä»¥å…ˆé€šè¿‡é¢„çƒ­çš„æ–¹å¼å°†é™æ€èµ„æºç¼“å­˜åˆ°CDNèŠ‚ç‚¹ï¼Œè¿™æ ·åœ¨è®¿é—®çš„æ—¶å€™å°±ä¸éœ€è¦è¿›è¡Œå›æºï¼Œå›æºæ˜¯æŒ‡CDNèŠ‚ç‚¹ä¸­æ²¡æœ‰éœ€è¦çš„é™æ€èµ„æºï¼Œé‡æ–°è¯·æ±‚æ‰“åˆ°æœåŠ¡å™¨ä¸Šã€‚å¦‚æœæœåŠ¡å™¨ä¸Šçš„èµ„æºæœ‰æ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨åˆ·æ–°åŠŸèƒ½ï¼Œåˆ é™¤CDNèŠ‚ç‚¹ä¸Šçš„æ—§èµ„æºï¼Œå›æºè·å–æœ€æ–°èµ„æºã€‚åŸºæœ¬çš„äº‘æœåŠ¡å•†éƒ½æä¾›äº†å›æºå’Œåˆ·æ–°çš„åŠŸèƒ½ã€‚æ‰€ä»¥å‘½ä¸­ç‡å’Œå›æºç‡æ˜¯è¡¡é‡CDNçš„é‡è¦æŒ‡æ ‡ã€‚
2. CDNä¼šé€šè¿‡GSLBï¼ˆå…¨å±€è´Ÿè½½å‡è¡¡ï¼‰è·å–å°±è¿‘çš„CDNèŠ‚ç‚¹ï¼Œå°†å°±è¿‘çš„CDNèŠ‚ç‚¹çš„ipè¿”å›ç»™æµè§ˆå™¨ã€‚GSLBä¼šæ ¹æ®è¯·æ±‚çš„IPåœ°å€ï¼ŒèŠ‚ç‚¹çš„çŠ¶æ€ï¼ˆè´Ÿè½½å‡è¡¡æƒ…å†µï¼Œæ€§èƒ½ï¼‰èƒ½å› ç´ æ¥å…·ä½“è¿”å›å“ªä¸€ä¸ªèŠ‚ç‚¹ã€‚

![1725242024937-35db7810-b4c0-4f15-8b07-de7c05235662.png](1725242024937-35db7810-b4c0-4f15-8b07-de7c05235662-947743.png)

3. è§£å†³èµ„æºç›—åˆ·çš„æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨Referené˜²ç›—é“¾ï¼Œé€šè¿‡è®¾ç½®Httpä¸­çš„referenå­—æ®µå¯¹è¯·æ±‚è¿›è¡Œé™åˆ¶ã€‚referenå­—æ®µè·å–å½“å‰è¯·æ±‚é¡µé¢çš„æ¥æºé¡µé¢çš„åœ°å€ï¼Œç¡®è®¤è¯·æ±‚æ˜¯å¦åˆæ³•ã€‚äº‘æœåŠ¡å•†æä¾›äº†ä¸“é—¨çš„è®¾ç½®Referenåœ°å€çš„åœ°æ–¹ã€‚ä½†æ˜¯å¦‚æœå…è®¸Referenä¸ºç©ºçš„è¯ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®Referenä¸ºç©ºç»•è¿‡é˜²ç›—é“¾ã€‚

ç›¸æ¯”è¾ƒäºæ—¶é—´æˆ³é˜²ç›—é“¾æ›´å®‰å…¨ä¸€ç‚¹ï¼Œæ—¶é—´æˆ³é˜²ç›—é“¾åŠ å¯†çš„URLå…·æœ‰æ—¶æ•ˆæ€§ï¼Œè¿‡æœŸä¹‹åæ— æ³•è®¿é—®ã€‚æ—¶é—´æˆ³é˜²ç›—é“¾é€šå¸¸æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ç­¾åå­—ç¬¦ä¸²ï¼Œä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œç­¾åå­—ç¬¦ä¸²æ˜¯å¯¹URLã€åŠ å¯†å­—ç¬¦ä¸²ã€è¿‡æœŸæ—¶é—´è¿›è¡Œä¸€ä¸ªMD5å“ˆå¸Œç®—æ³•å“ˆå¸Œçš„åŠ å¯†ã€‚ç°åœ¨çš„äº‘æœåŠ¡å•†ä¹Ÿæä¾›äº†æ—¶é—´æˆ³é˜²ç›—é“¾çš„è®¾ç½®ã€‚

é™¤äº† Referer é˜²ç›—é“¾å’Œæ—¶é—´æˆ³é˜²ç›—é“¾ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥ IP é»‘ç™½åå•é…ç½®ã€IP è®¿é—®é™é¢‘é…ç½®ç­‰æœºåˆ¶æ¥é˜²ç›—åˆ·



# è´Ÿè½½å‡è¡¡çš„åŸç†å’Œç®—æ³•åˆ†æ
**ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡ï¼Ÿ**

è´Ÿè½½å‡è¡¡æ˜¯æŒ‡å°†ç”¨æˆ·çš„è¯·æ±‚åˆ†æ‘Šåˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šé¢ï¼Œæé«˜ç³»ç»Ÿæ•´ä½“çš„å¹¶å‘å¤„ç†èƒ½åŠ›å’Œå“åº”èƒ½åŠ›ã€‚è´Ÿè½½å‡è¡¡æœ‰ä¸“é—¨çš„ç¡¬ä»¶æˆ–è€…è½¯ä»¶å®ç°ï¼Œç¡¬ä»¶æ€§èƒ½æ›´å¥½ï¼Œè½¯ä»¶ä»·æ ¼æ›´ä¾¿å®œã€‚

è´Ÿè½½å‡è¡¡æ˜¯ä¸€ç§æ¯”è¾ƒå®¹æ˜“å®ç°æé«˜ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›å’Œå¯é æ€§çš„æŠ€æœ¯ï¼Œä¸ç®¡åœ¨å•ä½“é¡¹ç›®è¿˜æ˜¯å¾®æœåŠ¡æ¶æ„çš„ç³»ç»Ÿéƒ½ä¼šç”¨åˆ°ã€‚

**è´Ÿè½½å‡è¡¡çš„åˆ†ç±»ï¼š**

1. æœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡ï¼š

æœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡ä¸»è¦åº”ç”¨åœ¨å¤–éƒ¨è¯·æ±‚åˆ°ç½‘å…³ä¹‹é—´ï¼Œå¯ä»¥ä½¿ç”¨ç¡¬ä»¶æˆ–è€…è½¯ä»¶å®ç°ã€‚

ç¡¬ä»¶å®ç°é€šè¿‡ä¸“é—¨çš„ç¡¬ä»¶è®¾å¤‡ï¼ˆæ¯”å¦‚ F5ã€A10ã€Array ï¼‰å®ç°è´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚ç¡¬ä»¶æ€§èƒ½å¥½ï¼Œä½†æ˜¯ä»·æ ¼è´µã€‚æˆ‘ä»¬èƒ½å¤Ÿæ¥è§¦æœ€å¤šçš„å°±æ˜¯è½¯ä»¶ã€‚

æ ¹æ®OSIæ¨¡å‹ï¼Œå¯ä»¥å°†è´Ÿè½½å‡è¡¡åˆ†ä¸ºï¼š

+ äºŒå±‚è´Ÿè½½å‡è¡¡
+ ä¸‰å±‚è´Ÿè½½å‡è¡¡
+ å››å±‚è´Ÿè½½å‡è¡¡
+ ä¸ƒå±‚è´Ÿè½½å‡è¡¡

æœ€å¸¸ç”¨çš„æ˜¯å››å±‚å’Œä¸ƒå±‚ã€‚

**å››å±‚è´Ÿè½½å‡è¡¡** å·¥ä½œåœ¨ OSI æ¨¡å‹ç¬¬å››å±‚ï¼Œä¹Ÿå°±æ˜¯ä¼ è¾“å±‚ï¼Œè¿™ä¸€å±‚çš„ä¸»è¦åè®®æ˜¯ TCP/UDPï¼Œè´Ÿè½½å‡è¡¡å™¨åœ¨è¿™ä¸€å±‚èƒ½å¤Ÿçœ‹åˆ°æ•°æ®åŒ…é‡Œçš„æºç«¯å£åœ°å€ä»¥åŠç›®çš„ç«¯å£åœ°å€ï¼Œä¼šåŸºäºè¿™äº›ä¿¡æ¯é€šè¿‡ä¸€å®šçš„è´Ÿè½½å‡è¡¡ç®—æ³•å°†æ•°æ®åŒ…è½¬å‘åˆ°åç«¯çœŸå®æœåŠ¡å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå››å±‚è´Ÿè½½å‡è¡¡çš„æ ¸å¿ƒå°±æ˜¯ IP+ç«¯å£å±‚é¢çš„è´Ÿè½½å‡è¡¡ï¼Œä¸æ¶‰åŠå…·ä½“çš„æŠ¥æ–‡å†…å®¹ã€‚

**ä¸ƒå±‚è´Ÿè½½å‡è¡¡** å·¥ä½œåœ¨ OSI æ¨¡å‹ç¬¬ä¸ƒå±‚ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨å±‚ï¼Œè¿™ä¸€å±‚çš„ä¸»è¦åè®®æ˜¯ HTTP ã€‚è¿™ä¸€å±‚çš„è´Ÿè½½å‡è¡¡æ¯”å››å±‚è´Ÿè½½å‡è¡¡è·¯ç”±ç½‘ç»œè¯·æ±‚çš„æ–¹å¼æ›´åŠ å¤æ‚ï¼Œå®ƒä¼šè¯»å–æŠ¥æ–‡çš„æ•°æ®éƒ¨åˆ†ï¼ˆæ¯”å¦‚è¯´æˆ‘ä»¬çš„ HTTP éƒ¨åˆ†çš„æŠ¥æ–‡ï¼‰ï¼Œç„¶åæ ¹æ®è¯»å–åˆ°çš„æ•°æ®å†…å®¹ï¼ˆå¦‚ URLã€Cookieï¼‰åšå‡ºè´Ÿè½½å‡è¡¡å†³ç­–ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ƒå±‚è´Ÿè½½å‡è¡¡å™¨çš„æ ¸å¿ƒæ˜¯æŠ¥æ–‡å†…å®¹ï¼ˆå¦‚ URLã€Cookieï¼‰å±‚é¢çš„è´Ÿè½½å‡è¡¡ï¼Œæ‰§è¡Œç¬¬ä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„è®¾å¤‡é€šå¸¸è¢«ç§°ä¸º **åå‘ä»£ç†æœåŠ¡å™¨** ã€‚

ä¸ƒå±‚æ¯”å››å±‚ä¼šæ¶ˆè€—æ›´å¤šçš„æ€§èƒ½ï¼Œä½†æ˜¯æ›´çµæ´»ï¼Œæ›´æ™ºèƒ½çš„è·¯ç”±ç½‘ç»œè¯·æ±‚ã€‚å››å±‚çš„æ€§èƒ½æ›´å¥½ï¼Œä¸ƒå±‚çš„åŠŸèƒ½æ›´å¤šã€‚ä½†æ˜¯åœ¨å¤§å¤šæ•°ä¸šåŠ¡ä¸‹ï¼Œå››å±‚å’Œä¸ƒå±‚çš„æ€§èƒ½å·®å¼‚å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚

å·¥ä½œä¸­ï¼Œå¸¸ç”¨Nginxåšä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼ŒLVSï¼ˆLinux Virtual Server è™šæ‹ŸæœåŠ¡å™¨ï¼ŒLinuxå†…æ ¸çš„4å±‚è´Ÿè½½å‡è¡¡ï¼‰åš4å±‚è´Ÿè½½å‡è¡¡ã€‚LVSåªæœ‰å¤§å‚æ‰ç”¨çš„åˆ°ï¼Œæˆ‘ä»¬æ¥è§¦æœ€å¤šçš„è¿˜æ˜¯Nginxã€‚

2. å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡

å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ä¸»è¦åœ¨ç³»ç»Ÿå†…éƒ¨çš„ä¸åŒæœåŠ¡ä¹‹é—´ï¼Œå¯ä»¥ä½¿ç”¨ç°æˆçš„è´Ÿè½½å‡è¡¡ç»„ä»¶å®ç°ã€‚

å®¢æˆ·ç«¯ä¼šç»´æŠ¤ä¸€ä»½æœåŠ¡å™¨çš„åœ°å€åˆ—è¡¨ï¼Œå‘é€è¯·æ±‚ä¹‹å‰ï¼Œä¼šæ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©å¯¹åº”çš„æœåŠ¡å™¨å¤„ç†è¯·æ±‚ã€‚

å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡å™¨å’ŒæœåŠ¡è¿è¡Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œä¸å­˜åœ¨é¢å¤–çš„ç½‘ç»œå¼€é”€ã€‚ä½†æ˜¯ï¼Œä¼šå—åˆ°ç¼–ç¨‹è¯­è¨€çš„é™åˆ¶ï¼Œæ¯”å¦‚SpringCloud Load Balanceåªé€‚ç”¨äºJavaã€‚

ç›®å‰ä¸»æµçš„å¾®æœåŠ¡æ¡†æ¶éƒ½æœ‰å®ç°å¥½çš„è´Ÿè½½å‡è¡¡å™¨ï¼ŒDubboé»˜è®¤è‡ªå¸¦äº†è´Ÿè½½å‡è¡¡å™¨ï¼ŒSpringCloud Load Balanceå®˜æ–¹æ¨èï¼ŒRibbonä¹Ÿå¯ä»¥å®ç°

**è´Ÿè½½å‡è¡¡ç®—æ³•ï¼š**

1. éšæœºæ³•

å¦‚æœæ²¡æœ‰åŠ æƒé‡ï¼Œé‚£ä¹ˆæ¯ä¸ªæœºå™¨èƒ½è¢«è®¿é—®åˆ°çš„å‡ ç‡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé€‚ç”¨äºæœåŠ¡å™¨æ€§èƒ½ç›¸è¿‘çš„é›†ç¾¤ï¼Œå¦‚æœåŠ äº†æƒé‡ï¼Œæƒé‡é«˜çš„è¢«é€‰ä¸­çš„å‡ ç‡æ›´é«˜ï¼Œé€‚ç”¨äºæœåŠ¡å™¨æ€§èƒ½ä¸ç­‰çš„é›†ç¾¤ã€‚

ä¼šå‡ºç°æœºå™¨å¾ˆé•¿æ—¶é—´ä¸ä¼šè¢«è®¿é—®çš„æƒ…å†µï¼Œæ¯•ç«Ÿæ˜¯æ¦‚ç‡ç®—æ³•ã€‚

2. è½®è¯¢æ³•

æ¯ä¸ªæœºå™¨éƒ½ä¼šè¢«è®¿é—®ï¼Œå¦‚æœæ²¡æœ‰åŠ æƒé‡ï¼Œä¼šæŒ‰ç…§æ—¶é—´é¡ºåºåˆ†é…æœåŠ¡å™¨ï¼Œå¦‚æœåŠ äº†æƒé‡ï¼Œé‚£ä¹ˆæƒé‡é«˜çš„åˆ†é…çš„æ¬¡æ•°ä¼šå˜å¤šã€‚

åŠ æƒè½®è¯¢æ”¹è¿›æœ‰å¹³æ»‘çš„åŠ æƒè½®è¯¢ç®—æ³•ã€‚

3. ä¸¤æ¬¡éšæœºæ³•

åœ¨éšæœºæ³•çš„åŸºç¡€ä¸Šå†éšæœºå‡ºä¸€å°æœåŠ¡å™¨ï¼Œåœ¨ä¸¤å°æœåŠ¡å™¨ä¸­æ ¹æ®è´Ÿè½½ç­‰æ¡ä»¶é€‰æ‹©ä¸€å°æœåŠ¡å™¨ã€‚

4. å“ˆå¸Œæ³•

æ ¹æ®ç”¨æˆ·çš„è¯·æ±‚ä¿¡æ¯é€šè¿‡å“ˆå¸Œå‡½æ•°è½¬æ¢ä¸ºä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œå†æ ¹æ®å“ˆå¸Œå€¼åˆ†é…æœåŠ¡å™¨ã€‚

æœåŠ¡å™¨æ•°é‡ä¸å˜çš„æƒ…å†µä¸‹ï¼ŒåŒä¸€ä¸ªipï¼ŒåŒä¸€ä¸ªç”¨æˆ·çš„è¯·æ±‚ä¼šå‘å‘ç›¸åŒçš„æœåŠ¡å™¨ã€‚

5. ä¸€è‡´æ€§hashæ³•

ä¸€è‡´æ€§hashæ³•çš„åŒä¸€ä¸ªipè¯·æ±‚ä¹Ÿä¼šå‘å‘ç›¸åŒçš„æœåŠ¡å™¨ã€‚

ä½†æ˜¯å“ˆå¸Œæ³•å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šæœåŠ¡å™¨æ•°é‡å˜åŒ–æ—¶ï¼Œå“ˆå¸Œå€¼ä¼šé‡æ–°è½åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚

ä¸€è‡´æ€§hashæ³•ä¼šå°†æ•°æ®å’ŒèŠ‚ç‚¹æ˜ å°„åœ¨ä¸€ä¸ªå“ˆå¸Œç¯ä¸Šï¼Œæ ¹æ®å“ˆå¸Œå€¼ç¡®å®šæ•°æ®å±äºå“ªä¸€ä¸ªèŠ‚ç‚¹ã€‚æœåŠ¡å™¨èŠ‚ç‚¹çš„å¢åŠ æˆ–è€…åˆ é™¤ï¼Œéƒ½ä¸ä¼šå¯¼è‡´æœåŠ¡å™¨é›†ç¾¤çš„å“ˆå¸Œé”®å€¼é‡æ–°åˆ†å¸ƒã€‚

6. æœ€å°è¿æ¥æ³•

æœ€å°è¿æ¥æ³•åŸºäºæœåŠ¡è¿æ¥æ•°é‡å»å“åº”ä¸åŒçš„æœåŠ¡å™¨ï¼Œä¼˜å…ˆé€‰æ‹©è¿æ¥æ•°å°‘çš„æœåŠ¡å™¨å“åº”æœåŠ¡ï¼Œä½†æ˜¯å®é™…æƒ…å†µæ˜¯ï¼Œå¹¶ä¸æ˜¯è¿æ¥æ•°é‡å°‘å°±ä»£è¡¨è´Ÿè½½å¾ˆå°ï¼Œæœ‰äº›è¿æ¥ä¾ç„¶å¾ˆå ç”¨ç³»ç»Ÿèµ„æºã€‚

7. æœ€å°‘æ´»è·ƒæ•°

æœ€å°‘æ´»è·ƒæ•°åŸºäºæœåŠ¡å™¨æ­£åœ¨æ´»è·ƒçš„è¿æ¥æ•°ä¸ºæ ‡å‡†ï¼Œä¹Ÿå°±æ˜¯æ­£åœ¨å¤„ç†çš„è¯·æ±‚æ•°ã€‚

8. æœ€å¿«å“åº”æ³•

åŸºäºæœåŠ¡å™¨çš„å“åº”æ—¶é—´ï¼Œä¼˜å…ˆé€‰æ‹©å“åº”æ—¶é—´æ›´çŸ­çš„æœåŠ¡å™¨ã€‚

**ä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„å®ç°ï¼š**

å¸¸è§çš„å®ç°æœ‰DNSè§£æå’Œåå‘ä»£ç†ã€‚

1. DNSè§£æ

DNSè§£æå®ç°è´Ÿè½½å‡è¡¡çš„åŸç†ï¼šåœ¨DNSæœåŠ¡å™¨ä¸­é…ç½®å¤šä¸ªIPåœ°å€ï¼Œè¿™äº›IPåœ°å€å¯¹åº”ç€ä¸åŒçš„æœåŠ¡å™¨ï¼Œå½“ç”¨æˆ·è¯·æ±‚DNSæ—¶ï¼Œæ ¹æ®ä¸åŒçš„è´Ÿè½½å‡è¡¡ç®—æ³•è¿”å›ä¸åŒçš„ipåœ°å€ã€‚ç°åœ¨äº‘æœåŠ¡å•†çš„DNSè§£æéƒ½é…ç½®äº†åŠŸèƒ½ã€‚

2. åå‘ä»£ç†

å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°åå‘ä»£ç†æœåŠ¡å™¨ï¼Œåå‘ä»£ç†æœåŠ¡å™¨é€‰æ‹©æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼Œè·å–æ•°æ®åè¿”å›å®¢æˆ·ç«¯ã€‚

å¯¹å¤–æš´éœ²çš„æ˜¯åå‘ä»£ç†æœåŠ¡å™¨çš„åœ°å€ï¼Œéšè—çœŸå®æœåŠ¡å™¨çš„åœ°å€ï¼Œä»£ç†æŒ‡çš„å°±æ˜¯ç›®æ ‡æœåŠ¡å™¨ã€‚

**å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„å®ç°ï¼š**

é€šè¿‡Netflix Ribbonæˆ–è€…Springcloud Load Balanceå®ç°ã€‚







å¾®æœåŠ¡ã€åˆ†å¸ƒå¼ã€äº‘åŸç”Ÿæ˜¯ä¸‰ä¸ª**ä¸åŒå±‚æ¬¡**çš„æ¦‚å¿µï¼Œå½¼æ­¤ç›¸å…³ä½†å…³æ³¨ç‚¹ä¸åŒã€‚å¯ä»¥ç®€å•ç†è§£ä¸ºï¼š  

âœ… **å¾®æœåŠ¡** â†’ ä¸€ç§æ¶æ„è®¾è®¡æ–¹å¼ï¼ˆå¦‚ä½•æ‹†åˆ†åº”ç”¨ï¼‰  
âœ… **åˆ†å¸ƒå¼** â†’ ä¸€ç§ç³»ç»Ÿéƒ¨ç½²æ–¹å¼ï¼ˆå¦‚ä½•è®©å¤šä¸ªæœåŠ¡å™¨ååŒå·¥ä½œï¼‰  
âœ… **äº‘åŸç”Ÿ** â†’ ä¸€ç§åº”ç”¨å¼€å‘ç†å¿µï¼ˆå¦‚ä½•å……åˆ†åˆ©ç”¨äº‘çš„ä¼˜åŠ¿ï¼‰  

---

# å¾®æœåŠ¡ã€åˆ†å¸ƒå¼ã€äº‘åŸç”Ÿçš„åŒºåˆ«
## ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ
**å¾®æœåŠ¡ï¼ˆMicroservicesï¼‰****æ˜¯ä¸€ç§****æ¶æ„é£æ ¼**ï¼Œå®ƒå°†ä¸€ä¸ªå¤§å‹å•ä½“åº”ç”¨æ‹†åˆ†ä¸ºå¤šä¸ª**å°å‹ç‹¬ç«‹çš„æœåŠ¡**ï¼Œæ¯ä¸ªæœåŠ¡è´Ÿè´£ç‰¹å®šçš„ä¸šåŠ¡åŠŸèƒ½ï¼Œå¹¶é€šè¿‡ APIï¼ˆé€šå¸¸æ˜¯ RESTful æˆ– gRPCï¼‰è¿›è¡Œé€šä¿¡ã€‚  

** å…³é”®ç‰¹ç‚¹**

+ **æ¯ä¸ªæœåŠ¡ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²**  
+ **æ¯ä¸ªå¾®æœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯æ ˆ**ï¼ˆJavaã€Goã€Pythonç­‰ï¼‰  
+ **é€šè¿‡ API è¿›è¡Œé€šä¿¡ï¼ˆHTTPã€RPCã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰**  
+ **å¯ä»¥ç‹¬ç«‹æ‰©å±•æŸä¸ªå¾®æœåŠ¡ï¼Œè€Œä¸å½±å“å…¶ä»–éƒ¨åˆ†**

** å…¸å‹æ¡ˆä¾‹**

ğŸš€ **ç”µå•†å¹³å°çš„å¾®æœåŠ¡æ¶æ„**  

+ ç”¨æˆ·æœåŠ¡ï¼ˆ`user-service`ï¼‰  
+ è®¢å•æœåŠ¡ï¼ˆ`order-service`ï¼‰  
+ æ”¯ä»˜æœåŠ¡ï¼ˆ`payment-service`ï¼‰  
+ å•†å“æœåŠ¡ï¼ˆ`product-service`ï¼‰

ğŸ’¡ **å¾®æœåŠ¡æ¶æ„çš„ç›®çš„**æ˜¯è®©åº”ç”¨å…·å¤‡**æ›´å¥½çš„çµæ´»æ€§ã€æ‰©å±•æ€§ã€ç‹¬ç«‹æ€§**ï¼Œä½†å®ƒæœ¬èº«å¹¶ä¸è¦æ±‚**å¿…é¡»æ˜¯åˆ†å¸ƒå¼çš„**ã€‚

---

## **ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ï¼Ÿ**
**åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆDistributed Systemï¼‰****æŒ‡çš„æ˜¯****å¤šä¸ªæœåŠ¡å™¨**å…±åŒç»„æˆä¸€ä¸ªç³»ç»Ÿï¼Œå¯¹å¤–æä¾›æœåŠ¡ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š  
**æŠŠä¸€ä¸ªå¤§ä»»åŠ¡æ‹†åˆ†ï¼Œäº¤ç»™å¤šä¸ªæœåŠ¡å™¨å¤„ç†ï¼Œæé«˜æ€§èƒ½ã€å¯é æ€§å’Œå¯æ‰©å±•æ€§ã€‚**  

**å…³é”®ç‰¹ç‚¹**

+ **æ•°æ®å­˜å‚¨å’Œè®¡ç®—åˆ†å¸ƒåœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Š**ï¼ˆé¿å…å•ç‚¹æ•…éšœï¼‰  
+ **æœåŠ¡ä¹‹é—´é€šè¿‡ç½‘ç»œé€šä¿¡ï¼ˆRPCã€HTTPã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰**  
+ **å¯ä»¥æ°´å¹³æ‰©å±•ï¼ˆå¢åŠ æœºå™¨æ¥æé«˜æ€§èƒ½ï¼‰**

**å…¸å‹æ¡ˆä¾‹**

âœ… **åˆ†å¸ƒå¼æ•°æ®åº“**ï¼ˆå¦‚ MySQL Shardingã€TiDBã€MongoDBï¼‰  
âœ… **åˆ†å¸ƒå¼ç¼“å­˜**ï¼ˆå¦‚ Redis Clusterï¼‰  
âœ… **åˆ†å¸ƒå¼è®¡ç®—**ï¼ˆå¦‚ Hadoopã€Sparkï¼‰  
âœ… **åˆ†å¸ƒå¼å¾®æœåŠ¡**ï¼ˆSpring Cloudã€Dubboï¼‰  

ğŸ’¡ **åˆ†å¸ƒå¼æ¶æ„çš„ç›®çš„æ˜¯æé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€å®¹é”™æ€§å’Œå¯æ‰©å±•æ€§**ã€‚  
ğŸ’¡ **å¾®æœåŠ¡å¹¶ä¸ä¸€å®šæ˜¯åˆ†å¸ƒå¼çš„ï¼Œä½†åˆ†å¸ƒå¼ç³»ç»Ÿé€šå¸¸ä¼šé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ã€‚**

---

## **3. ä»€ä¹ˆæ˜¯äº‘åŸç”Ÿï¼Ÿ**
**äº‘åŸç”Ÿï¼ˆCloud Nativeï¼‰****æ˜¯ä¸€ç§****å¼€å‘å’Œéƒ¨ç½²åº”ç”¨çš„ç†å¿µ**ï¼Œå®ƒå¼ºè°ƒåº”ç”¨åº”è¯¥å……åˆ†åˆ©ç”¨äº‘è®¡ç®—çš„ç‰¹æ€§ï¼ˆå¼¹æ€§ã€è‡ªåŠ¨åŒ–ã€åˆ†å¸ƒå¼ï¼‰ã€‚  

**å…³é”®ç‰¹ç‚¹**

+ **åº”ç”¨è¿è¡Œåœ¨å®¹å™¨ï¼ˆDockerï¼‰ä¸­ï¼Œå¹¶ç”± Kubernetes è¿›è¡Œç®¡ç†**  
+ **åº”ç”¨å¯ä»¥è‡ªåŠ¨æ‰©å±•ã€è‡ªåŠ¨æ¢å¤ï¼ˆå¼¹æ€§ä¼¸ç¼©ï¼‰**  
+ **æœåŠ¡ä¹‹é—´é€šè¿‡ API é€šä¿¡ï¼Œé€šå¸¸åŸºäºå¾®æœåŠ¡æ¶æ„**  
+ **å¼ºè°ƒ DevOpsï¼ˆå¼€å‘ä¸è¿ç»´ä¸€ä½“åŒ–ï¼‰å’Œ CI/CDï¼ˆè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼‰**

**å…¸å‹æ¡ˆä¾‹**

âœ… **Kubernetesï¼ˆK8sï¼‰+ å¾®æœåŠ¡æ¶æ„**  
âœ… **äº‘å‡½æ•°ï¼ˆServerlessï¼Œå¦‚ AWS Lambdaã€é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—ï¼‰**  
âœ… **Service Meshï¼ˆå¦‚ Istioï¼Œç®¡ç†å¾®æœåŠ¡é€šä¿¡ï¼‰**  

ğŸ’¡ **äº‘åŸç”Ÿçš„æ ¸å¿ƒç›®æ ‡**æ˜¯è®©åº”ç”¨åœ¨äº‘ä¸Šè¿è¡Œå¾—æ›´ç¨³å®šã€é«˜æ•ˆã€è‡ªåŠ¨åŒ–ã€‚

---

## **4. ä¸‰è€…çš„å…³ç³»**
| **å¯¹æ¯”é¡¹** | **å¾®æœåŠ¡ï¼ˆMicroservicesï¼‰** | **åˆ†å¸ƒå¼ï¼ˆDistributedï¼‰** | **äº‘åŸç”Ÿï¼ˆCloud Nativeï¼‰** |
| --- | --- | --- | --- |
| **æ¦‚å¿µå±‚çº§** | æ¶æ„è®¾è®¡æ–¹å¼ | ç³»ç»Ÿéƒ¨ç½²æ–¹å¼ | åº”ç”¨å¼€å‘ç†å¿µ |
| **æ˜¯å¦ä¸€å®šè¦ç”¨äº‘** | âŒ ä¸æ˜¯å¿…é¡»çš„ | âŒ ä¸æ˜¯å¿…é¡»çš„ | âœ… ä¾èµ–äº‘ç¯å¢ƒ |
| **æ˜¯å¦ä¸€å®šè¦åˆ†å¸ƒå¼** | âŒ ä¸æ˜¯å¿…é¡»çš„ï¼ˆå•æœºä¹Ÿèƒ½è·‘ï¼‰ | âœ… å¿…é¡»æ˜¯åˆ†å¸ƒå¼ | âœ… é€šå¸¸æ˜¯åˆ†å¸ƒå¼ |
| **ä¸ K8s å…³ç³»** | å¯ä»¥ç”¨ K8sï¼Œä½†ä¸æ˜¯å¿…é¡» | å¯ä»¥ç”¨ K8sï¼Œä½†ä¸æ˜¯å¿…é¡» | âœ… K8s æ˜¯äº‘åŸç”Ÿçš„æ ¸å¿ƒ |
| **æ ¸å¿ƒç›®æ ‡** | é™ä½è€¦åˆï¼Œæé«˜çµæ´»æ€§ | æé«˜æ€§èƒ½ã€å¯æ‰©å±•æ€§ | å……åˆ†åˆ©ç”¨äº‘çš„å¼¹æ€§ã€è‡ªåŠ¨åŒ– |


---

## **5. æ€»ç»“**
+ **å¾®æœåŠ¡**ï¼šä¸€ç§**æ¶æ„é£æ ¼**ï¼Œæ‹†åˆ†å¤§ç³»ç»Ÿä¸ºå¤šä¸ªç‹¬ç«‹çš„æœåŠ¡ã€‚  
+ **åˆ†å¸ƒå¼**ï¼šä¸€ç§**ç³»ç»Ÿéƒ¨ç½²æ–¹å¼**ï¼Œå¤šä¸ªæœåŠ¡å™¨ååŒå¤„ç†ä»»åŠ¡ã€‚  
+ **äº‘åŸç”Ÿ**ï¼šä¸€ç§**åº”ç”¨å¼€å‘ç†å¿µ**ï¼Œå¼ºè°ƒè‡ªåŠ¨åŒ–ã€å¼¹æ€§æ‰©å±•ï¼Œé€šå¸¸åŸºäº Kubernetesã€‚

ğŸ’¡ **ç®€å•ç†è§£ï¼š**

+ ä½ å¯ä»¥**åªç”¨å¾®æœåŠ¡ï¼Œè€Œä¸ä½¿ç”¨åˆ†å¸ƒå¼**ï¼ˆæ¯”å¦‚å•æœºéƒ¨ç½²å¤šä¸ªå¾®æœåŠ¡ï¼‰ã€‚  
+ ä½ å¯ä»¥**åªåšåˆ†å¸ƒå¼ï¼Œè€Œä¸ä½¿ç”¨å¾®æœåŠ¡**ï¼ˆæ¯”å¦‚ä¼ ç»Ÿçš„åˆ†å¸ƒå¼æ•°æ®åº“ï¼‰ã€‚  
+ ä½ å¯ä»¥**åšå¾®æœåŠ¡ + åˆ†å¸ƒå¼ + äº‘åŸç”Ÿ**ï¼Œè®©ç³»ç»Ÿæ—¢è§£è€¦ã€åˆé«˜å¯ç”¨ã€è¿˜èƒ½è‡ªåŠ¨æ‰©å±•ï¼ˆæ¯”å¦‚ Kubernetes + å¾®æœåŠ¡ï¼‰ã€‚

å¦‚æœä½ åœ¨é¡¹ç›®ä¸­è€ƒè™‘å¾®æœåŠ¡ã€åˆ†å¸ƒå¼æˆ–äº‘åŸç”Ÿï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ä½ çš„å…·ä½“åœºæ™¯ï¼Œæˆ‘å¯ä»¥å¸®ä½ åˆ†æå“ªç§æ¶æ„æ›´é€‚åˆ ğŸ˜Š



# SpringBooté›†æˆSwagger
æ·»åŠ ä¾èµ–ï¼š
```xml
 <!--swaggerä¾èµ–-->
<dependency>
    <groupId>io.springfox</groupId>
    <artifactId>springfox-swagger2</artifactId>
    <version>2.9.2</version>
</dependency>
<!--swagger ui-->
<dependency>
    <groupId>io.springfox</groupId>
    <artifactId>springfox-swagger-ui</artifactId>
    <version>2.9.2</version>
</dependency>
```
Swaggeré…ç½®ç±»ï¼š
```java
@Configuration
@EnableSwagger2
public class Swagger2Config {
    /**åˆ›å»ºAPIåº”ç”¨
      apiInfo() å¢åŠ APIç›¸å…³ä¿¡æ¯
        * é€šè¿‡select()å‡½æ•°è¿”å›ä¸€ä¸ªApiSelectorBuilderå®ä¾‹,ç”¨æ¥æ§åˆ¶å“ªäº›æ¥å£æš´éœ²ç»™Swaggeræ¥å±•ç°ï¼Œ
           æŒ‡å®šæ‰«æçš„åŒ…è·¯å¾„æ¥å®šä¹‰æŒ‡å®šè¦å»ºç«‹APIçš„ç›®å½•ã€‚*/ 

      @Bean
      public Docket coreApiConfig(){
               return new Docket(DocumentationType.SWAGGER_2)
               .apiInfo(adminApiInfo())
               .groupName("adminApi")
               .select()
               //åªæ˜¾ç¤ºadminä¸‹é¢çš„è·¯å¾„
               .paths(Predicates.and(PathSelectors.regex("/admin/.*")))
               .build();
                   }

    private ApiInfo adminApiInfo(){
        return new ApiInfoBuilder()
                .title("å°šèå®åå°ç®¡ç†ç³»ç»Ÿ--apiæ–‡æ¡£")
                .description("å°šèå®åå°ç®¡ç†ç³»ç»Ÿæ¥å£æè¿°")
                .version("1.0")
                .contact(new Contact("ljd","http://baidu.com","123456778@qq.com"))
                .build();
    }

}
```

è®¿é—®åœ°å€ï¼š/swagger-ui.html

# Springdoc
ä¸Šé¢çš„swaggerè€å‡ºç°é—®é¢˜ï¼Œå¯ä»¥é€‰ç”¨è¿™ä¸ªSpringdoc
```java
<dependency>  
    <groupId>org.springdoc</groupId>  
    <artifactId>springdoc-openapi-ui</artifactId>  
    <version>1.8.0</version>  
</dependency>
```
```yaml
springdoc:  
  swagger-ui:  
    path: /swagger-ui.html  
  packages-to-scan: com.art.artworks
```
è®¿é—®åœ°å€ï¼š/swagger-ui/index.htmlæˆ–è€…/swagger-ui.html
